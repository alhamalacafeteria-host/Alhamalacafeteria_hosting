
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Al Hamala Cafeteria - Export Dashboard</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://hdtbveombnhozbxognvr.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdGJ2ZW9tYm5ob3pieG9nbnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjc4NDMsImV4cCI6MjA3NDgwMzg0M30.J1gETcvnnd47IyumvjzNGLMADQjQdcsnbr6SQOGSpsM'
    );

    async function exportData(format) {
      const { data, error } = await supabase.from('entries').select('*');
      if (error) {
        alert('Error fetching data');
        return;
      }

      if (format === 'json') {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        downloadBlob(blob, 'entries.json');
      } else if (format === 'csv' || format === 'excel') {
        const csv = convertToCSV(data);
        const blob = new Blob([csv], { type: 'text/csv' });
        const filename = format === 'csv' ? 'entries.csv' : 'entries.xlsx';
        downloadBlob(blob, filename);
      }
    }

    function convertToCSV(data) {
      const headers = Object.keys(data[0]);
      const rows = data.map(row => headers.map(field => JSON.stringify(row[field] || '')).join(','));
      return [headers.join(','), ...rows].join('
');
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    window.exportData = exportData;
  </script>
</head>
<body>
  <h2>Al Hamala Cafeteria - Export Dashboard</h2>
  <button onclick="exportData('json')">Export JSON</button>
  <button onclick="exportData('csv')">Export CSV</button>
  <button onclick="exportData('excel')">Export Excel</button>
</body>
</html>
