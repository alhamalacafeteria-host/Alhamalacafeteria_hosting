
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Restaurant Accounts - Supabase Only</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    input, select { margin: 5px; padding: 5px; }
    .section { margin-bottom: 40px; }
  </style>
</head>
<body>

<h1>Restaurant Accounts Management (Supabase Only)</h1>

<div class="section">
  <h2>Add Entry</h2>
  <form id="entry-form">
    <input type="text" id="date" placeholder="Date (dd/mm/yyyy)" required>
    <select id="type">
      <option value="Income">Income</option>
      <option value="Expense">Expense</option>
    </select>
    <select id="cash_or_account">
      <option value="Cash">Cash</option>
      <option value="Benefit">Benefit</option>
    </select>
    <input type="number" id="amount" placeholder="Amount" required>
    <input type="text" id="description" placeholder="Description">
    <button type="submit">Add Entry</button>
  </form>
</div>

<div class="section">
  <h2>All Entries</h2>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Cash/Account</th>
        <th>Amount</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody id="entries-table-body">
      <tr><td colspan="5">Loading...</td></tr>
    </tbody>
  </table>
</div>

<div class="section">
  <h2>Monthly Report</h2>
  <input type="month" id="report-month">
  <button onclick="generateMonthlyReport()">Generate</button>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Cash Income</th>
        <th>Cash Expense</th>
        <th>Benefit Income</th>
        <th>Benefit Expense</th>
        <th>Net</th>
      </tr>
    </thead>
    <tbody id="monthly-report-body">
      <tr><td colspan="6">No report yet.</td></tr>
    </tbody>
  </table>
</div>

<div class="section">
  <h2>Daily Sales</h2>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Total Income</th>
      </tr>
    </thead>
    <tbody id="daily-sales-body">
      <tr><td colspan="2">No data yet.</td></tr>
    </tbody>
  </table>
</div>

<script>
  const supabaseUrl = 'https://hdtbveombnhozbxognvr.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdGJ2ZW9tYm5ob3pieG9nbnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjc4NDMsImV4cCI6MjA3NDgwMzg0M30.J1gETcvnnd47IyumvjzNGLMADQjQdcsnbr6SQOGSpsM';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function fetchEntries() {
    const { data, error } = await supabase.from('entries').select('*');
    const tableBody = document.getElementById('entries-table-body');
    if (error || !data) {
      tableBody.innerHTML = '<tr><td colspan="5">Error loading entries</td></tr>';
      return;
    }
    tableBody.innerHTML = '';
    data.forEach(entry => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${entry.date}</td>
        <td>${entry.type}</td>
        <td>${entry.cash_or_account}</td>
        <td>${entry.amount}</td>
        <td>${entry.description}</td>
      `;
      tableBody.appendChild(row);
    });
  }

  document.getElementById('entry-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const entry = {
      date: document.getElementById('date').value,
      type: document.getElementById('type').value,
      cash_or_account: document.getElementById('cash_or_account').value,
      amount: parseFloat(document.getElementById('amount').value),
      description: document.getElementById('description').value
    };
    const { error } = await supabase.from('entries').insert([entry]);
    if (error) {
      alert('Error adding entry');
    } else {
      fetchEntries();
      e.target.reset();
    }
  });

  async function generateMonthlyReport() {
    const monthInput = document.getElementById('report-month').value;
    if (!monthInput) return;
    const [year, month] = monthInput.split('-');
    const { data, error } = await supabase.from('entries').select('*');
    const reportBody = document.getElementById('monthly-report-body');
    if (error || !data) {
      reportBody.innerHTML = '<tr><td colspan="6">Error loading report</td></tr>';
      return;
    }

    const dailySummary = {};
    data.forEach(entry => {
      const [dd, mm, yyyy] = entry.date.split('/');
      if (mm === month && yyyy === year) {
        if (!dailySummary[entry.date]) {
          dailySummary[entry.date] = { cash_income: 0, cash_expense: 0, benefit_income: 0, benefit_expense: 0 };
        }
        const summary = dailySummary[entry.date];
        if (entry.type === 'Income') {
          if (entry.cash_or_account === 'Cash') summary.cash_income += entry.amount;
          else summary.benefit_income += entry.amount;
        } else {
          if (entry.cash_or_account === 'Cash') summary.cash_expense += entry.amount;
          else summary.benefit_expense += entry.amount;
        }
      }
    });

    reportBody.innerHTML = '';
    for (const date in dailySummary) {
      const s = dailySummary[date];
      const net = (s.cash_income + s.benefit_income) - (s.cash_expense + s.benefit_expense);
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${date}</td>
        <td>${s.cash_income.toFixed(2)}</td>
        <td>${s.cash_expense.toFixed(2)}</td>
        <td>${s.benefit_income.toFixed(2)}</td>
        <td>${s.benefit_expense.toFixed(2)}</td>
        <td>${net.toFixed(2)}</td>
      `;
      reportBody.appendChild(row);
    }
  }

  async function generateDailySales() {
    const { data, error } = await supabase.from('entries').select('*');
    const salesBody = document.getElementById('daily-sales-body');
    if (error || !data) {
      salesBody.innerHTML = '<tr><td colspan="2">Error loading sales</td></tr>';
      return;
    }

    const salesSummary = {};
    data.forEach(entry => {
      if (entry.type === 'Income') {
        if (!salesSummary[entry.date]) salesSummary[entry.date] = 0;
        salesSummary[entry.date] += entry.amount;
      }
    });

    salesBody.innerHTML = '';
    for (const date in salesSummary) {
      const row = document.createElement('tr');
      row.innerHTML = `<td>${date}</td><td>${salesSummary[date].toFixed(2)}</td>`;
      salesBody.appendChild(row);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    fetchEntries();
    generateDailySales();
  });
</script>

</body>
</html>
