
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Al Hamala Cafeteria - Accounting Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-4">Al Hamala Cafeteria - Accounting Dashboard</h1>

    <div class="row mb-4">
      <div class="col-md-3"><div class="card text-bg-success"><div class="card-body">Total Income: <span id="totalIncome">0</span></div></div></div>
      <div class="col-md-3"><div class="card text-bg-danger"><div class="card-body">Total Expense: <span id="totalExpense">0</span></div></div></div>
      <div class="col-md-3"><div class="card text-bg-info"><div class="card-body">Net: <span id="net">0</span></div></div></div>
      <div class="col-md-3"><div class="card text-bg-warning"><div class="card-body">Cash I/E: <span id="cashIE">0</span></div></div></div>
    </div>

    <div class="card mb-4">
      <div class="card-header">Add/Edit Entry</div>
      <div class="card-body">
        <form id="entryForm">
          <div class="row g-3">
            <div class="col-md-3">
              <select class="form-select" id="type">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="account">
                <option value="cash">Cash</option>
                <option value="benefit">Benefit</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="number" class="form-control" id="amount" placeholder="Amount" required>
            </div>
            <div class="col-md-3">
              <button type="submit" class="btn btn-primary w-100">Save</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Entries</div>
      <div class="card-body">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Type</th>
              <th>Account</th>
              <th>Amount</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="entriesTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const supabaseUrl = 'https://hdtbveombnhozbxognvr.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdGJ2ZW9tYm5ob3pieG9nbnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjc4NDMsImV4cCI6MjA3NDgwMzg0M30.J1gETcvnnd47IyumvjzNGLMADQjQdcsnbr6SQOGSpsM';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function loadEntries() {
      const { data, error } = await supabase.from('entries').select('*');
      if (error) return console.error(error);

      let income = 0, expense = 0, cashIE = 0;
      const table = document.getElementById('entriesTable');
      table.innerHTML = '';

      data.forEach(entry => {
        const row = `<tr>
          <td>${entry.type}</td>
          <td>${entry.account}</td>
          <td>${entry.amount}</td>
          <td>${new Date(entry.created_at).toLocaleDateString()}</td>
        </tr>`;
        table.innerHTML += row;

        if (entry.type === 'income') income += entry.amount;
        else expense += entry.amount;

        if (entry.account === 'cash') cashIE += entry.amount;
      });

      document.getElementById('totalIncome').textContent = income;
      document.getElementById('totalExpense').textContent = expense;
      document.getElementById('net').textContent = income - expense;
      document.getElementById('cashIE').textContent = cashIE;
    }

    document.getElementById('entryForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const type = document.getElementById('type').value;
      const account = document.getElementById('account').value;
      const amount = parseFloat(document.getElementById('amount').value);

      const { error } = await supabase.from('entries').insert([{ type, account, amount }]);
      if (error) return console.error(error);

      document.getElementById('entryForm').reset();
      loadEntries();
    });

    loadEntries();
  </script>
</body>
</html>
