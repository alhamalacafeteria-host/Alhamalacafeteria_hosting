<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant Accounts Manager</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f6f8; color: #333; }
    header { background: #2c3e50; color: #fff; padding: 15px; text-align: center; font-size: 1.5em; }
    .container { padding: 20px; }
    .dashboard { display: flex; justify-content: space-around; margin-bottom: 20px; flex-wrap: wrap; }
    .card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 30%; text-align: center; margin: 10px; }
    .form-section, .table-section, .report-section { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, select, button { padding: 10px; margin: 5px; width: calc(100% - 20px); border: 1px solid #ccc; border-radius: 5px; }
    button { background: #3498db; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #2980b9; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
    .actions button { margin: 0 5px; padding: 5px 10px; }
    .export-buttons button { margin: 5px; }
</style>
https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2</script>
https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js</script>
</head>
<body>
<header>Restaurant Accounts Manager</header>
<div class="container">
    <!-- Dashboard -->
    <div class="dashboard">
        <div class="card"><h3>Total Income</h3><p id="totalIncome">$0</p></div>
        <div class="card"><h3>Total Expense</h3><p id="totalExpense">$0</p></div>
        <div class="card"><h3>Net</h3><p id="net">$0</p></div>
    </div>

    <!-- Add/Edit Entry -->
    <div class="form-section">
        <h3>Add / Edit Entry</h3>
        <form id="entryForm">
            <input type="date" id="date" required>
            <select id="type" required>
                <option value="">Select Type</option>
                <option value="Income">Income</option>
                <option value="Expense">Expense</option>
            </select>
            <select id="account" required>
                <option value="">Select Account</option>
                <option value="Cash">Cash</option>
                <option value="Benefit">Benefit</option>
            </select>
            <input type="number" id="amount" placeholder="Amount" required>
            <input type="text" id="description" placeholder="Description">
            <button type="submit">Save</button>
            <button type="reset">Reset</button>
        </form>
    </div>

    <!-- Filter & Export -->
    <div class="form-section">
        <h3>Filter & Export</h3>
        <input type="date" id="startDate">
        <input type="date" id="endDate">
        <select id="filterType">
            <option value="">All Types</option>
            <option value="Income">Income</option>
            <option value="Expense">Expense</option>
        </select>
        <select id="filterAccount">
            <option value="">All Accounts</option>
            <option value="Cash">Cash</option>
            <option value="Benefit">Benefit</option>
        </select>
        <button onclick="applyFilter()">Apply Filter</button>
        <div class="export-buttons">
            <button onclick="exportCSV()">Export CSV</button>
            <button onclick="exportJSON()">Export JSON</button>
            <button onclick="exportExcel()">Export Excel</button>
            <input type="file" id="importJSON" accept=".json" onchange="importJSONFile(event)">
        </div>
    </div>

    <!-- Entries Table -->
    <div class="table-section">
        <h3>Entries</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th><th>Type</th><th>Account</th><th>Amount</th><th>Description</th><th>Actions</th>
                </tr>
            </thead>
            <tbody id="entriesTable"><tr><td colspan="6">No entries yet</td></tr></tbody>
        </table>
    </div>

    <!-- Monthly Report -->
    <div class="report-section">
        <h3>Monthly Report</h3>
        <button onclick="generateMonthlyReport()">Generate Report</button>
        <button onclick="exportMonthlyCSV()">Export Monthly CSV</button>
        <table>
            <thead>
                <tr><th>Date</th><th>Cash Income</th><th>Cash Expense</th><th>Benefit Income</th><th>Benefit Expense</th><th>Daily Net</th></tr>
            </thead>
            <tbody id="monthlyReport"><tr><td colspan="6">No report yet</td></tr></tbody>
        </table>
    </div>
</div>

<script>
const supabase = supabase.createClient(
    'https://hdtbveombnhozbxognvr.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdGJ2ZW9tYm5ob3pieG9nbnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjc4NDMsImV4cCI6MjA3NDgwMzg0M30.J1gETcvnnd47IyumvjzNGLMADQjQdcsnbr6SQOGSpsM'
);

let entries = [];

// Load entries
async function loadEntries() {
    const { data, error } = await supabase.from('entries').select('*').order('date', { ascending: false });
    if (error) { console.error(error); return; }
    entries = data;
    renderEntries(entries);
    updateDashboard(entries);
}

function renderEntries(data) {
    const table = document.getElementById('entriesTable');
    table.innerHTML = '';
    if (data.length === 0) {
        table.innerHTML = '<tr><td colspan="6">No entries yet</td></tr>';
        return;
    }
    data.forEach(entry => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${entry.date}</td>
            <td>${entry.type}</td>
            <td>${entry.account}</td>
            <td>$${entry.amount}</td>
            <td>${entry.description || ''}</td>
            <td class="actions">
                <button onclick="editEntry(${entry.id})">Edit</button>
                <button onclick="deleteEntry(${entry.id})">Delete</button>
            </td>
        `;
        table.appendChild(row);
    });
}

function updateDashboard(data) {
    let totalIncome = 0, totalExpense = 0;
    data.forEach(e => e.type === 'Income' ? totalIncome += e.amount : totalExpense += e.amount);
    document.getElementById('totalIncome').textContent = '$' + totalIncome;
    document.getElementById('totalExpense').textContent = '$' + totalExpense;
    document.getElementById('net').textContent = '$' + (totalIncome - totalExpense);
}

// Add entry
document.getElementById('entryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const date = document.getElementById('date').value;
    const type = document.getElementById('type').value;
    const account = document.getElementById('account').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const description = document.getElementById('description').value;

    const { error } = await supabase.from('entries').insert([{ date, type, account, amount, description }]);
    if (error) { alert('Error adding entry'); console.error(error); }
    else { alert('Entry added successfully'); loadEntries(); document.getElementById('entryForm').reset(); }
});

// Delete entry
async function deleteEntry(id) {
    const { error } = await supabase.from('entries').delete().eq('id', id);
    if (error) { alert('Error deleting entry'); console.error(error); }
    else { alert('Entry deleted'); loadEntries(); }
}

// Edit entry
async function editEntry(id) {
    const { data } = await supabase.from('entries').select('*').eq('id', id).single();
    document.getElementById('date').value = data.date;
    document.getElementById('type').value = data.type;
    document.getElementById('account').value = data.account;
    document.getElementById('amount').value = data.amount;
    document.getElementById('description').value = data.description;
}

// Filter
function applyFilter() {
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    const type = document.getElementById('filterType').value;
    const account = document.getElementById('filterAccount').value;
    let filtered = entries.filter(e => {
        return (!start || e.date >= start) && (!end || e.date <= end) &&
               (!type || e.type === type) && (!account || e.account === account);
    });
    renderEntries(filtered);
}

// Export CSV
function exportCSV() {
    let csv = 'Date,Type,Account,Amount,Description\n';
    entries.forEach(e => csv += `${e.date},${e.type},${e.account},${e.amount},${e.description || ''}\n`);
    downloadFile(csv, 'entries.csv', 'text/csv');
}

// Export JSON
function exportJSON() {
    downloadFile(JSON.stringify(entries, null, 2), 'entries.json', 'application/json');
}

// Export Excel
function exportExcel() {
    const ws = XLSX.utils.json_to_sheet(entries);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Entries');
    XLSX.writeFile(wb, 'entries.xlsx');
}

// Import JSON
function importJSONFile(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = async (e) => {
        const imported = JSON.parse(e.target.result);
        for (let entry of imported) {
            await supabase.from('entries').insert([entry]);
        }
        alert('Data imported successfully');
        loadEntries();
    };
    reader.readAsText(file);
}

function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename; a.click();
    URL.revokeObjectURL(url);
}

// Monthly Report
function generateMonthlyReport() {
    const reportTable = document.getElementById('monthlyReport');
    reportTable.innerHTML = '';
    const grouped = {};
    entries.forEach(e => {
        if (!grouped[e.date]) grouped[e.date] = { cashIncome: 0, cashExpense: 0, benefitIncome: 0, benefitExpense: 0 };
        if (e.account === 'Cash') {
            e.type === 'Income' ? grouped[e.date].cashIncome += e.amount : grouped[e.date].cashExpense += e.amount;
        } else {
            e.type === 'Income' ? grouped[e.date].benefitIncome += e.amount : grouped[e.date].benefitExpense += e.amount;
        }
    });
    for (let date in grouped) {
        const g = grouped[date];
        const net = (g.cashIncome + g.benefitIncome) - (g.cashExpense + g.benefitExpense);
        const row = `<tr><td>${date}</td><td>${g.cashIncome}</td><td>${g.cashExpense}</td><td>${g.benefitIncome}</td><td>${g.benefitExpense}</td><td>${net}</td></tr>`;
        reportTable.innerHTML += row;
    }
}

function exportMonthlyCSV() {
    let csv = 'Date,Cash Income,Cash Expense,Benefit Income,Benefit Expense,Daily Net\n';
    const grouped = {};
    entries.forEach(e => {
        if (!grouped[e.date]) grouped[e.date] = { cashIncome: 0, cashExpense: 0, benefitIncome: 0, benefitExpense: 0 };
        if (e.account === 'Cash') {
            e.type === 'Income' ? grouped[e.date].cashIncome += e.amount : grouped[e.date].cashExpense += e.amount;
        } else {
            e.type === 'Income' ? grouped[e.date].benefitIncome += e.amount : grouped[e.date].benefitExpense += e.amount;
        }
    });
    for (let date in grouped) {
        const g = grouped[date];
        const net = (g.cashIncome + g.benefitIncome) - (g.cashExpense + g.benefitExpense);
        csv += `${date},${g.cashIncome},${g.cashExpense},${g.benefitIncome},${g.benefitExpense},${net}\n`;
    }
    downloadFile(csv, 'monthly_report.csv', 'text/csv');
}

loadEntries();
</script>
</body>
</html>