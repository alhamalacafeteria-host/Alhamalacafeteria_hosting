
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Al Hamala Cafeteria - Accounting Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="text-center mb-4">Al Hamala Cafeteria - Accounting Dashboard</h2>

    <!-- Login -->
    <div id="loginSection" class="card p-4 mb-4">
      <h4>Login</h4>
      <input type="text" id="username" class="form-control mb-2" placeholder="Username" />
      <input type="password" id="password" class="form-control mb-2" placeholder="Password" />
      <button class="btn btn-primary" onclick="login()">Login</button>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display:none;">
      <div class="row text-center mb-4">
        <div class="col"><h5>Total Income: <span id="totalIncome">0</span></h5></div>
        <div class="col"><h5>Total Expense: <span id="totalExpense">0</span></h5></div>
        <div class="col"><h5>Net: <span id="net">0</span></h5></div>
        <div class="col"><h5>Cash I/E: <span id="cashIE">0</span></h5></div>
        <div class="col"><h5>Benefit I/E: <span id="benefitIE">0</span></h5></div>
      </div>

      <!-- Entry Form -->
      <div class="card p-4 mb-4">
        <h4>Add/Edit Entry</h4>
        <input type="date" id="entryDate" class="form-control mb-2" />
        <select id="entryType" class="form-control mb-2">
          <option value="Income">Income</option>
          <option value="Expense">Expense</option>
        </select>
        <select id="entryAccount" class="form-control mb-2">
          <option value="Cash">Cash</option>
          <option value="Benefit">Benefit</option>
        </select>
        <input type="number" id="entryAmount" class="form-control mb-2" placeholder="Amount" />
        <input type="text" id="entryDesc" class="form-control mb-2" placeholder="Description" />
        <button class="btn btn-success" onclick="saveEntry()">Save</button>
        <button class="btn btn-secondary" onclick="resetForm()">Reset</button>
      </div>
    </div>
  </div>

  <!-- Supabase and Script -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = window.supabase.createClient(
      "https://hdtbveombnhozbxognvr.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdGJ2ZW9tYm5ob3pieG9nbnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjc4NDMsImV4cCI6MjA3NDgwMzg0M30.J1gETcvnnd47IyumvjzNGLMADQjQdcsnbr6SQOGSpsM"
    );

    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (user === "admin" && pass === "admin") {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        loadDashboard();
      } else {
        alert("Invalid credentials");
      }
    }

    async function loadDashboard() {
      const { data, error } = await supabase.from("entries").select("*");
      if (error) return alert("Error loading data");

      let income = 0, expense = 0, cashIE = 0, benefitIE = 0;
      data.forEach(entry => {
        const amt = parseFloat(entry.amount);
        if (entry.type === "Income") income += amt;
        else expense += amt;

        if (entry.account === "Cash") cashIE += amt;
        else benefitIE += amt;
      });

      document.getElementById("totalIncome").textContent = income;
      document.getElementById("totalExpense").textContent = expense;
      document.getElementById("net").textContent = income - expense;
      document.getElementById("cashIE").textContent = cashIE;
      document.getElementById("benefitIE").textContent = benefitIE;
    }

    async function saveEntry() {
      const entry = {
        date: document.getElementById("entryDate").value,
        type: document.getElementById("entryType").value,
        account: document.getElementById("entryAccount").value,
        amount: document.getElementById("entryAmount").value,
        description: document.getElementById("entryDesc").value
      };
      const { error } = await supabase.from("entries").insert([entry]);
      if (error) return alert("Error saving entry");
      alert("Entry saved!");
      loadDashboard();
      resetForm();
    }

    function resetForm() {
      document.getElementById("entryDate").value = "";
      document.getElementById("entryType").value = "Income";
      document.getElementById("entryAccount").value = "Cash";
      document.getElementById("entryAmount").value = "";
      document.getElementById("entryDesc").value = "";
    }
  </script>
</body>
</html>
