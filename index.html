
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Al Hamala Cafeteria - Accounting Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

</head>
<body class="bg-light">
<div class="container py-4">
<h2 class="text-center mb-4">Al Hamala Cafeteria - Accounting Dashboard</h2>
<!-- Login -->
<div class="card p-4 mb-4" id="loginSection">
<h4>Login</h4>
<input class="form-control mb-2" id="username" placeholder="Username" type="text"/>
<input class="form-control mb-2" id="password" placeholder="Password" type="password"/>
<button class="btn btn-primary" onclick="login()">Login</button>
</div>
<!-- Dashboard -->
<div id="dashboard" style="display:none;">
<div class="row text-center mb-4">
<div class="col"><h5>Total Income: <span id="totalIncome">0</span></h5></div>
<div class="col"><h5>Total Expense: <span id="totalExpense">0</span></h5></div>
<div class="col"><h5>Net: <span id="net">0</span></h5></div>
<div class="col"><h5>Cash I/E: <span id="cashIE">0</span></h5></div>
<div class="col"><h5>Benefit I/E: <span id="benefitIE">0</span></h5></div>
</div>
<!-- Entry Form -->
<div class="card p-4 mb-4">
<h4>Add/Edit Entry</h4>
<input class="form-control mb-2" id="entryDate" type="date"/>
<select class="form-control mb-2" id="entryType">
<option value="Income">Income</option>
<option value="Expense">Expense</option>
</select>
<select class="form-control mb-2" id="entryAccount">
<option value="Cash">Cash</option>
<option value="Benefit">Benefit</option>
</select>
<input class="form-control mb-2" id="entryAmount" placeholder="Amount" type="number"/>
<input class="form-control mb-2" id="entryDesc" placeholder="Description" type="text"/>
<button class="btn btn-success" onclick="saveEntry()">Save</button>
<button class="btn btn-secondary" onclick="resetForm()">Reset</button>
</div>
<!-- Filter & Export -->
<div class="card p-4 mb-4">
<h4>Filter &amp; Export</h4>
<input class="form-control mb-2" id="filterStart" type="date"/>
<input class="form-control mb-2" id="filterEnd" type="date"/>
<select class="form-control mb-2" id="filterType">
<option value="">All Types</option>
<option value="Income">Income</option>
<option value="Expense">Expense</option>
</select>
<select class="form-control mb-2" id="filterAccount">
<option value="">All Accounts</option>
<option value="Cash">Cash</option>
<option value="Benefit">Benefit</option>
</select>
<button class="btn btn-info mb-2" onclick="filterEntries()">Apply Filter</button>
<button class="btn btn-outline-primary" onclick="exportData('json')">Export JSON</button>
<button class="btn btn-outline-success" onclick="exportData('csv')">Export CSV</button>
<button class="btn btn-outline-warning" onclick="exportData('excel')">Export Excel</button>
<input class="form-control mt-2" id="importFile" onchange="importData()" type="file"/>
</div>
<!-- Monthly Report -->
<div class="card p-4 mb-4">
<h4>Monthly Report</h4>
<input class="form-control mb-2" id="reportMonth" type="month"/>
<button class="btn btn-dark" onclick="generateMonthlyReport()">Generate Report</button>
<button class="btn btn-outline-dark" onclick="exportMonthlyCSV()">Export CSV</button>
<div class="mt-3" id="monthlyReport"></div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script><script>
    document.addEventListener('DOMContentLoaded', function () {
        const supabase = window.supabase.createClient(
            'https://hdtbveombnhozbxognvr.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdGJ2ZW9tYm5ob3pieG9nbnZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMjc4NDMsImV4cCI6MjA3NDgwMzg0M30.J1gETcvnnd47IyumvjzNGLMADQjQdcsnbr6SQOGSpsM'
        );

        window.supabaseClient = supabase;

        // Reassign functions to use window.supabaseClient
        window.loadDashboard = async function () {
            const { data, error } = await window.supabaseClient.from('entries').select('*');
            if (error) return alert("Error loading data");
            console.log("Dashboard data:", data);
        };

        window.saveEntry = async function () {
            const entry = {
                date: document.getElementById("entryDate").value,
                type: document.getElementById("entryType").value,
                account: document.getElementById("entryAccount").value,
                amount: document.getElementById("entryAmount").value,
                description: document.getElementById("entryDesc").value
            };
            const { error } = await window.supabaseClient.from("entries").insert([entry]);
            if (error) return alert("Error saving entry");
            alert("Entry saved!");
            window.loadDashboard();
        };
    });
    </script></body>
</html>
